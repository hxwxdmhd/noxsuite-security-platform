<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoxSuite Audit Dashboard</title>
    <style>
        :root {
            --primary-color: #1e88e5;
            --secondary-color: #26a69a;
            --success-color: #43a047;
            --warning-color: #ff9800;
            --danger-color: #e53935;
            --light-bg: #f5f7fa;
            --dark-bg: #263238;
            --text-color: #455a64;
            --light-text: #eceff1;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--light-bg);
            margin: 0;
            padding: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        h1, h2, h3, h4 {
            margin-top: 0;
        }
        
        .dashboard-title {
            margin: 0;
            font-size: 24px;
            font-weight: 500;
        }
        
        .refresh-time {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            padding: 20px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 500;
            margin: 0;
        }
        
        .badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            color: white;
        }
        
        .badge-success {
            background-color: var(--success-color);
        }
        
        .badge-warning {
            background-color: var(--warning-color);
        }
        
        .badge-danger {
            background-color: var(--danger-color);
        }
        
        .progress-container {
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            border-radius: 5px;
            transition: width 1s ease;
        }
        
        .progress-value {
            font-size: 24px;
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .progress-label {
            font-size: 14px;
            opacity: 0.7;
        }
        
        .gate-cards {
            margin-top: 30px;
        }
        
        .gate-status {
            display: flex;
            align-items: center;
        }
        
        .status-icon {
            font-size: 24px;
            margin-right: 10px;
        }
        
        .test-list {
            margin-top: 15px;
        }
        
        .test-item {
            padding: 10px 0;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }
        
        .test-name {
            display: flex;
            align-items: center;
        }
        
        .test-indicator {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            margin-right: 10px;
            flex-shrink: 0;
        }
        
        .test-pass {
            background-color: var(--success-color);
        }
        
        .test-fail {
            background-color: var(--danger-color);
        }
        
        .test-skip {
            background-color: var(--warning-color);
        }
        
        footer {
            margin-top: 40px;
            text-align: center;
            font-size: 14px;
            color: #78909c;
            padding: 20px 0;
        }
        
        .button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s ease;
        }
        
        .button:hover {
            background-color: #1976d2;
        }
        
        .button-secondary {
            background-color: var(--secondary-color);
        }
        
        .button-secondary:hover {
            background-color: #00897b;
        }
        
        .actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .error-message {
            background-color: #ffebee;
            color: var(--danger-color);
            padding: 10px;
            border-radius: 4px;
            margin: 20px 0;
            border-left: 4px solid var(--danger-color);
        }
        
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Dark mode */
        .dark-mode {
            background-color: var(--dark-bg);
            color: var(--light-text);
        }
        
        .dark-mode .card {
            background-color: #37474f;
            color: var(--light-text);
        }
        
        .dark-mode .progress-container {
            background-color: #455a64;
        }
        
        .dark-mode .test-item {
            border-color: #455a64;
        }
        
        .mode-toggle {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <h1 class="dashboard-title">NoxSuite Audit Dashboard</h1>
                <div>
                    <button class="mode-toggle" onclick="toggleDarkMode()">🌓</button>
                    <span class="refresh-time">Last updated: <span id="last-update">Loading...</span></span>
                </div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div class="summary-cards">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Overall Progress</h2>
                    <span class="badge" id="overall-status-badge">CHECKING</span>
                </div>
                <div class="progress-value" id="overall-progress-value">0%</div>
                <div class="progress-container">
                    <div class="progress-bar" id="overall-progress-bar" style="width: 0%; background-color: var(--primary-color);"></div>
                </div>
                <div class="progress-label">Gates passed: <span id="gates-passed">0</span>/<span id="total-gates">8</span></div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Test Results</h2>
                </div>
                <div class="progress-value" id="tests-passed-value">0/0</div>
                <div class="progress-container">
                    <div class="progress-bar" id="tests-progress-bar" style="width: 0%; background-color: var(--secondary-color);"></div>
                </div>
                <div class="progress-label">Pass rate: <span id="pass-rate">0%</span></div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Current Gate</h2>
                    <span class="badge" id="current-gate-badge">N/A</span>
                </div>
                <div class="progress-value" id="current-gate-name">No active gate</div>
                <div class="progress-container">
                    <div class="progress-bar" id="current-gate-progress" style="width: 0%; background-color: var(--warning-color);"></div>
                </div>
                <div class="progress-label">Threshold: <span id="current-gate-threshold">N/A</span></div>
            </div>
        </div>
        
        <div class="gate-cards" id="gate-cards-container">
            <!-- Gates will be inserted here dynamically -->
            <div class="loading-spinner"></div>
        </div>
        
        <div class="actions">
            <button class="button" onclick="refreshData()">Refresh Data</button>
            <button class="button button-secondary" onclick="runAllTests()">Run All Tests</button>
        </div>
        
        <div id="error-container"></div>
    </div>
    
    <footer>
        <p>NoxSuite Audit Dashboard | TestSprite Integration | v1.0.0</p>
    </footer>
    
    <script>
        // Configuration
        const API_BASE = "http://localhost:8090/testsprite";
        const API_KEY = "sk-user-_77AvIpT2nWK_kIO9pZatRtvWHRNp2nZe1miSCqvo10OW3c_nunlho0vAAagP3I4qkOgqTB6N4KbrfmpQbGrVCWhhILUwW-cvoNrDsJbst4NOAaiMIp6tZqrE0aMnnegy74";
        
        // Sample gate data (replace with API calls)
        const gates = [
            {
                id: 1,
                name: "Foundation",
                description: "Project foundation and structure",
                status: "pass",
                score: 85,
                threshold: 70,
                tests: [
                    { id: "foundation-1", name: "Project Structure", status: "pass" },
                    { id: "foundation-2", name: "Core System Files", status: "pass" },
                    { id: "foundation-3", name: "Configuration Files", status: "pass" },
                    { id: "foundation-4", name: "Docker Infrastructure", status: "fail" },
                    { id: "foundation-5", name: "Documentation", status: "pass" }
                ]
            },
            {
                id: 2,
                name: "Security",
                description: "Security implementation and testing",
                status: "fail",
                score: 65,
                threshold: 80,
                tests: [
                    { id: "security-1", name: "Authentication", status: "pass" },
                    { id: "security-2", name: "Authorization", status: "fail" },
                    { id: "security-3", name: "Data Encryption", status: "pass" },
                    { id: "security-4", name: "Security Headers", status: "fail" }
                ]
            },
            {
                id: 3,
                name: "Performance",
                description: "System performance and optimization",
                status: "pending",
                score: 0,
                threshold: 75,
                tests: [
                    { id: "performance-1", name: "Response Time", status: "skip" },
                    { id: "performance-2", name: "Throughput", status: "skip" },
                    { id: "performance-3", name: "Resource Usage", status: "skip" },
                    { id: "performance-4", name: "Scalability", status: "skip" }
                ]
            }
        ];
        
        // Initialize dark mode from localStorage
        function initDarkMode() {
            const darkModeEnabled = localStorage.getItem('darkMode') === 'true';
            if (darkModeEnabled) {
                document.body.classList.add('dark-mode');
            }
        }
        
        // Toggle dark mode
        function toggleDarkMode() {
            const isDarkMode = document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', isDarkMode);
        }
        
        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString();
        }
        
        // Get badge class based on status
        function getBadgeClass(status) {
            switch (status) {
                case 'pass':
                    return 'badge-success';
                case 'fail':
                    return 'badge-danger';
                default:
                    return 'badge-warning';
            }
        }
        
        // Get badge text based on status
        function getBadgeText(status) {
            switch (status) {
                case 'pass':
                    return 'PASSED';
                case 'fail':
                    return 'FAILED';
                default:
                    return 'PENDING';
            }
        }
        
        // Create gate card HTML
        function createGateCardHtml(gate) {
            const badgeClass = getBadgeClass(gate.status);
            const badgeText = getBadgeText(gate.status);
            
            let statusIcon = '';
            if (gate.status === 'pass') {
                statusIcon = '✅';
            } else if (gate.status === 'fail') {
                statusIcon = '❌';
            } else {
                statusIcon = '⏳';
            }
            
            let testsHtml = '';
            gate.tests.forEach(test => {
                let indicatorClass = '';
                if (test.status === 'pass') {
                    indicatorClass = 'test-pass';
                } else if (test.status === 'fail') {
                    indicatorClass = 'test-fail';
                } else {
                    indicatorClass = 'test-skip';
                }
                
                testsHtml += `
                    <div class="test-item">
                        <div class="test-name">
                            <div class="test-indicator ${indicatorClass}"></div>
                            ${test.name}
                        </div>
                        <div>${test.status === 'pass' ? 'Pass' : test.status === 'fail' ? 'Fail' : 'Skipped'}</div>
                    </div>
                `;
            });
            
            return `
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Gate ${gate.id}: ${gate.name}</h2>
                        <span class="badge ${badgeClass}">${badgeText}</span>
                    </div>
                    <div class="gate-status">
                        <div class="status-icon">${statusIcon}</div>
                        <div>${gate.description}</div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar" style="width: ${gate.score}%; background-color: ${gate.status === 'pass' ? 'var(--success-color)' : gate.status === 'fail' ? 'var(--danger-color)' : 'var(--warning-color)'}"></div>
                    </div>
                    <div class="progress-label">Score: ${gate.score}% (Threshold: ${gate.threshold}%)</div>
                    <div class="test-list">
                        ${testsHtml}
                    </div>
                </div>
            `;
        }
        
        // Update summary cards
        function updateSummaryCards(data) {
            const totalGates = data.length;
            const passedGates = data.filter(gate => gate.status === 'pass').length;
            const overallProgress = totalGates > 0 ? Math.round((passedGates / totalGates) * 100) : 0;
            
            // Calculate test statistics
            let totalTests = 0;
            let passedTests = 0;
            
            data.forEach(gate => {
                gate.tests.forEach(test => {
                    totalTests++;
                    if (test.status === 'pass') {
                        passedTests++;
                    }
                });
            });
            
            const passRate = totalTests > 0 ? Math.round((passedTests / totalTests) * 100) : 0;
            
            // Update overall progress
            document.getElementById('overall-progress-value').textContent = `${overallProgress}%`;
            document.getElementById('overall-progress-bar').style.width = `${overallProgress}%`;
            document.getElementById('gates-passed').textContent = passedGates;
            document.getElementById('total-gates').textContent = totalGates;
            
            const overallStatusBadge = document.getElementById('overall-status-badge');
            if (overallProgress === 100) {
                overallStatusBadge.textContent = 'COMPLETE';
                overallStatusBadge.className = 'badge badge-success';
            } else if (overallProgress > 0) {
                overallStatusBadge.textContent = 'IN PROGRESS';
                overallStatusBadge.className = 'badge badge-warning';
            } else {
                overallStatusBadge.textContent = 'NOT STARTED';
                overallStatusBadge.className = 'badge badge-danger';
            }
            
            // Update test results
            document.getElementById('tests-passed-value').textContent = `${passedTests}/${totalTests}`;
            document.getElementById('tests-progress-bar').style.width = `${passRate}%`;
            document.getElementById('pass-rate').textContent = `${passRate}%`;
            
            // Update current gate
            let currentGate = null;
            for (let i = 0; i < data.length; i++) {
                if (data[i].status !== 'pass') {
                    currentGate = data[i];
                    break;
                }
            }
            
            if (currentGate) {
                document.getElementById('current-gate-name').textContent = `Gate ${currentGate.id}: ${currentGate.name}`;
                document.getElementById('current-gate-progress').style.width = `${currentGate.score}%`;
                document.getElementById('current-gate-threshold').textContent = `${currentGate.threshold}%`;
                
                const currentGateBadge = document.getElementById('current-gate-badge');
                currentGateBadge.textContent = getBadgeText(currentGate.status);
                currentGateBadge.className = `badge ${getBadgeClass(currentGate.status)}`;
            } else if (totalGates > 0 && passedGates === totalGates) {
                // All gates passed
                document.getElementById('current-gate-name').textContent = 'All gates passed!';
                document.getElementById('current-gate-progress').style.width = '100%';
                document.getElementById('current-gate-progress').style.backgroundColor = 'var(--success-color)';
                document.getElementById('current-gate-threshold').textContent = 'N/A';
                
                const currentGateBadge = document.getElementById('current-gate-badge');
                currentGateBadge.textContent = 'COMPLETE';
                currentGateBadge.className = 'badge badge-success';
            }
        }
        
        // Load gate data
        function loadGateData() {
            // In a real implementation, fetch data from API
            // For demo, use sample data
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve(gates);
                }, 500);
            });
        }
        
        // Refresh data
        async function refreshData() {
            try {
                document.getElementById('gate-cards-container').innerHTML = '<div class="loading-spinner"></div>';
                document.getElementById('error-container').innerHTML = '';
                document.getElementById('last-update').textContent = 'Refreshing...';
                
                const gateData = await loadGateData();
                
                // Sort gates by ID
                gateData.sort((a, b) => a.id - b.id);
                
                // Update last refresh time
                document.getElementById('last-update').textContent = new Date().toLocaleString();
                
                // Update summary cards
                updateSummaryCards(gateData);
                
                // Render gate cards
                const gateCardsContainer = document.getElementById('gate-cards-container');
                gateCardsContainer.innerHTML = '';
                
                gateData.forEach(gate => {
                    const gateCardHtml = createGateCardHtml(gate);
                    gateCardsContainer.innerHTML += gateCardHtml;
                });
            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('error-container').innerHTML = `
                    <div class="error-message">
                        Error loading data: ${error.message}
                    </div>
                `;
                document.getElementById('last-update').textContent = 'Failed to refresh';
            }
        }
        
        // Run all tests
        async function runAllTests() {
            try {
                document.getElementById('error-container').innerHTML = '';
                
                // In a real implementation, call API to run tests
                alert('Running all audit tests...');
                
                // Refresh data after a delay
                setTimeout(refreshData, 1000);
            } catch (error) {
                console.error('Error running tests:', error);
                document.getElementById('error-container').innerHTML = `
                    <div class="error-message">
                        Error running tests: ${error.message}
                    </div>
                `;
            }
        }
        
        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            initDarkMode();
            refreshData();
        });
    </script>
</body>
</html>
