[tox]
envlist = py38,py39,py310,py311,py312,py313,pypy3,lint,security
skip_missing_interpreters = true

[testenv]
deps = 
    pytest>=7.0.0
    pytest-asyncio>=0.21.0
    pytest-cov>=4.0.0
    httpx>=0.25.0
    sqlalchemy>=2.0.0
    pymysql>=1.0.0
    argon2-cffi>=23.0.0
    pyotp>=2.8.0
    qrcode[pil]>=7.4.0
    fastapi>=0.100.0
    uvicorn[standard]>=0.23.0
    pydantic[email]>=2.0.0
    python-jose[cryptography]>=3.3.0
    passlib[bcrypt]>=1.7.4
    email-validator>=2.0.0

commands = 
    pytest tests/ -v --cov=./ --cov-report=term-missing --cov-report=xml

[testenv:lint]
deps = 
    black>=23.0.0
    isort>=5.12.0
    flake8>=6.0.0
    mypy>=1.5.0
    bandit>=1.7.5

commands = 
    black --check --diff .
    isort --check-only --diff .
    flake8 .
    mypy --ignore-missing-imports .
    bandit -r . -x tests/

[testenv:security]
deps = 
    bandit[toml]>=1.7.5
    safety>=2.3.0
    pip-audit>=2.6.0

commands = 
    bandit -r . -f json -o bandit-report.json
    safety check --json --output safety-report.json
    pip-audit --format=json --output=pip-audit-report.json

[testenv:format]
deps = 
    black>=23.0.0
    isort>=5.12.0

commands = 
    black .
    isort .

[flake8]
max-line-length = 88
extend-ignore = E203, W503, E501
exclude = 
    .git,
    __pycache__,
    archive,
    deprecated,
    backup_*,
    .venv,
    venv,
    build,
    dist,
    .tox

[coverage:run]
source = .
omit = 
    tests/*
    .tox/*
    .venv/*
    venv/*
    archive/*
    deprecated/*
    backup_*/*

[coverage:report]
precision = 2
show_missing = true
skip_covered = false

[mypy]
python_version = 3.8
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = false
ignore_missing_imports = true